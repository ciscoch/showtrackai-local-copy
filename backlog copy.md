# Backlog (Flutter Web)

## Completed Tasks âœ…

### Initial Setup & Authentication
- [x] Fix authentication token handling âœ…
- [x] Add COPPA compliance for minors âœ…
- [x] Implement input validation âœ…
- [x] Add offline storage limits âœ…
- [x] Create comprehensive tests âœ…
- [x] Animal create page (name, tag) âœ…
- [x] Journal entry form with weather + geolocation âœ…
- [x] Supabase RLS (owner only) âœ…
- [x] Connect journal to n8n workflow at https://showtrackai.app.n8n.cloud/workflow/IA4KVsPotkhtYfW8 âœ…
- [x] Push to git code_automation branch on https://github.com/ciscoch/showtrackai-local-copy.git do not merge to main âœ…
- [x] Fix supabase authentication error: main.dart.js:101168 âœ…
- [x] Remove mock data. Use only real data in database. Do not use offline mode right now. âœ…

### UI/UX â€” Journal Entry â†’ SPAR Integration (Completed)

#### Core form fields (Journal payload â†’ journal_entries)
- [x] User selector (required) â†’ sets `user_id` âœ…
- [x] Animal selector (required) â†’ sets `animal_id` âœ…
- [x] Title text input (default: "Journal Entry") â†’ `title` âœ…
- [x] Rich text / multiline input (required) â†’ `entry_text` âœ…
- [x] Date picker (YYYY-MM-DD) â†’ `entry_date` âœ…
- [x] Category select (training, feeding, health, show, general) â†’ `category` âœ…
- [x] Duration number (minutes) with stepper â†’ `duration_minutes` âœ…
- [x] FFA standards multi-select chips (e.g., AS.06.02, AS.07.01) â†’ `ffa_standards[]` âœ…
- [x] Learning objectives tokens/chips â†’ `learning_objectives[]` âœ…

#### Weight/feeding mini-panel (normalizes `feed_strategy`)
- [x] Current weight (number, lbs) â†’ `feed_strategy.current_weight` âœ…
- [x] Target weight (number, lbs) â†’ `feed_strategy.target_weight` âœ…
- [x] Target/next weigh-in date â†’ `feed_strategy.weigh_in_date` âœ…

#### Location & weather (best-effort)
- [x] Location widget (city, state) + hidden lat/lon when available â†’ `location.{city,state,lat,lon}` âœ…
- [x] "Attach weather" button (fills preview chip) â†’ store compact JSON in `weather` âœ…
- [x] "Use IP-based weather if GPS not granted" toggle â†’ sets source hint âœ…

#### Metadata & source
- [x] Source select (mobile_app, web_app, import, api) â†’ `metadata.source` âœ…
- [x] Optional notes textarea â†’ `metadata.notes` âœ…

#### Retrieval query (for vector + planner)
- [x] Hidden field auto-composed: `${entry_text}\nFFA: ${ffa_standards}\nObjectives: ${learning_objectives}\nWeight update: cw=${current_weight} â€¢ tw=${target_weight} â€¢ d=${entry_date}`
  â†’ submit as `retrieval_query` âœ…

#### SPAR run controls (Advanced, collapsible)
- [x] "Send to SPAR Orchestrator" checkbox (default ON) âœ…
- [x] Readonly `run_id` preview (client trace id) to correlate UI â†” n8n âœ…
- [x] Advanced routing: `route.intent` select (default `edu_context`) âœ…
- [x] Vector tuning inputs: `vector.match_count` (default 6), `vector.min_similarity` (default 0.75) âœ…
- [x] Tool inputs override (optional): `tool_inputs.category`, `tool_inputs.query` (defaults to retrieval_query) âœ…

#### Validation (before submit)
- [x] Block submit if `user_id` or `animal_id` missing âœ…
- [x] Block submit if `entry_text` empty âœ…
- [x] Warn if `entry_date` missing; allow continue with today âœ…
- [x] If weather fetch attempted and fails, proceed without weather but log warning âœ…

## Now




- [] SHO-5 https://linear.app/showtrackai/issue/SHO-5/i-cannot-save-edits-to-animals I cannot save edits to animals without error. 


#NOW






## Recently Completed Tasks âœ…

### Core Infrastructure
- [x] **Trace ID for observability** - Implemented in journal_entry_form_page.dart:
  - Generated once per submission for end-to-end correlation
  - Persisted through entire SPAR/N8N flow
  - Used in logging for distributed tracing

- [x] **Toast notification system** - Full implementation in journal_toast_service.dart:
  - Multi-stage submission flow (Submitting â†’ Success â†’ Processing â†’ Stored â†’ AI Complete)
  - Error handling with retry capability
  - Action buttons for viewing entries/results
  - Complete visual feedback throughout journal submission

- [x] **SPAR runs persistence** - Complete service implementation:
  - SPARRunsService created with full lifecycle tracking
  - Database integration for spar_runs table
  - Status tracking: pending â†’ processing â†’ completed/failed
  - Metadata and error tracking

- [x] **N8N webhook integration** - Fully operational:
  - N8NWebhookService with retry logic
  - Payload building with all journal metadata
  - Integration with SPAR tracking
  - Error handling and fallback mechanisms

### Partial Implementations (Need Verification)

- [âš ï¸] **Weather pill on timeline** - Weather service exists but not fully integrated:
  - WeatherService stub created but API not configured
  - Weather data structure in place
  - UI integration needed for timeline display

- [âš ï¸] **Preview assessment area** - Structure exists but not visible:
  - Variables defined (_assessmentResult, _showAssessmentPreview)
  - SPARAssessmentResult type referenced but not defined
  - UI component needs to be created

## Current Active Task ğŸš§

- [] SHO-5 https://linear.app/showtrackai/issue/SHO-5/i-cannot-save-edits-to-animals I cannot save edits to animals without error. 


## Remaining Tasks ğŸ“‹

### Post-submit Persistence (Verification Needed)
- [ ] Verify `journal_entries` upsert is working correctly with all fields
- [ ] Confirm server-side assessment storage in `journal_entry_ai_assessments`
- [ ] Validate that SPAR results are properly stored when N8N completes

### UI Completions
- [ ] Complete weather pill display on timeline (API integration needed)
- [ ] Implement assessment preview UI component
- [ ] Add visual indicators for AI processing status
